From 57cb5e72af6a8764074b84610c50122a98d9a397 Mon Sep 17 00:00:00 2001
From: "David R. Bild" <david.bild@xaptum.com>
Date: Thu, 14 Jun 2018 19:06:38 -0500
Subject: [PATCH 1/2] xaprc001: add initial configurations

---
 contrib/board/Config.in.board                      |   1 +
 contrib/board/Config.in.boardname                  |   1 +
 contrib/board/xaptum/xaprc001/Config.in.board      |  12 +
 contrib/board/xaptum/xaprc001/Config.in.boardname  |   2 +
 contrib/board/xaptum/xaprc001/board.mk             |   2 +
 contrib/board/xaptum/xaprc001/xaprc001.c           | 462 +++++++++++++++++++++
 contrib/board/xaptum/xaprc001/xaprc001.h           |  68 +++
 .../xaptum/xaprc001/xaprc001mmc_uboot_defconfig    |   8 +
 .../xaprc001/xaprc001mmc_uboot_dev_defconfig       |   9 +
 contrib/include/contrib_board.h                    |   4 +
 10 files changed, 569 insertions(+)
 create mode 100644 contrib/board/xaptum/xaprc001/Config.in.board
 create mode 100644 contrib/board/xaptum/xaprc001/Config.in.boardname
 create mode 100644 contrib/board/xaptum/xaprc001/board.mk
 create mode 100644 contrib/board/xaptum/xaprc001/xaprc001.c
 create mode 100644 contrib/board/xaptum/xaprc001/xaprc001.h
 create mode 100644 contrib/board/xaptum/xaprc001/xaprc001mmc_uboot_defconfig
 create mode 100644 contrib/board/xaptum/xaprc001/xaprc001mmc_uboot_dev_defconfig

diff --git a/contrib/board/Config.in.board b/contrib/board/Config.in.board
index 2c67225..c0f6d36 100644
--- a/contrib/board/Config.in.board
+++ b/contrib/board/Config.in.board
@@ -8,3 +8,4 @@ source "contrib/board/acme/sama5d3_acqua/Config.in.board"
 source "contrib/board/acme/sama5d2_roadrunner/Config.in.board"
 source "contrib/board/corewind/core9g25/Config.in.board"
 source "contrib/board/axentia/sama5d3_linea/Config.in.board"
+source "contrib/board/xaptum/xaprc001/Config.in.board"
diff --git a/contrib/board/Config.in.boardname b/contrib/board/Config.in.boardname
index fe843fe..cd11c7c 100644
--- a/contrib/board/Config.in.boardname
+++ b/contrib/board/Config.in.boardname
@@ -8,3 +8,4 @@ source "contrib/board/acme/sama5d3_acqua/Config.in.boardname"
 source "contrib/board/acme/sama5d2_roadrunner/Config.in.boardname"
 source "contrib/board/corewind/core9g25/Config.in.boardname"
 source "contrib/board/axentia/sama5d3_linea/Config.in.boardname"
+source "contrib/board/xaptum/xaprc001/Config.in.boardname"
diff --git a/contrib/board/xaptum/xaprc001/Config.in.board b/contrib/board/xaptum/xaprc001/Config.in.board
new file mode 100644
index 0000000..a6e7b8c
--- /dev/null
+++ b/contrib/board/xaptum/xaprc001/Config.in.board
@@ -0,0 +1,12 @@
+config CONFIG_XAPRC001
+	bool "xaprc001"
+	select SAMA5D2
+	select CONFIG_CPU_V7
+	select CONFIG_DDRC
+	select ALLOW_SDCARD
+	select ALLOW_CPU_CLK_498MHZ
+	select ALLOW_CRYSTAL_12_000MHZ
+	select CONFIG_HAS_HW_INFO
+	select SUPPORT_BUS_SPEED_166MHZ
+	help
+	  Use the Xaptum XAP-RC-001 platform
diff --git a/contrib/board/xaptum/xaprc001/Config.in.boardname b/contrib/board/xaptum/xaprc001/Config.in.boardname
new file mode 100644
index 0000000..1fa827b
--- /dev/null
+++ b/contrib/board/xaptum/xaprc001/Config.in.boardname
@@ -0,0 +1,2 @@
+config CONFIG_BOARDNAME
+	default "xaprc001" if CONFIG_XAPRC001
diff --git a/contrib/board/xaptum/xaprc001/board.mk b/contrib/board/xaptum/xaprc001/board.mk
new file mode 100644
index 0000000..208973b
--- /dev/null
+++ b/contrib/board/xaptum/xaprc001/board.mk
@@ -0,0 +1,2 @@
+CPPFLAGS += -DCONFIG_XAPRC001
+ASFLAGS += -DCONFIG_XAPRC001
diff --git a/contrib/board/xaptum/xaprc001/xaprc001.c b/contrib/board/xaptum/xaprc001/xaprc001.c
new file mode 100644
index 0000000..14596c7
--- /dev/null
+++ b/contrib/board/xaptum/xaprc001/xaprc001.c
@@ -0,0 +1,462 @@
+/**
+ *  Copyright (c) 2018, Xaptum, Inc.
+ */
+#include "common.h"
+#include "hardware.h"
+#include "pmc.h"
+#include "usart.h"
+#include "debug.h"
+#include "ddramc.h"
+#include "gpio.h"
+#include "timer.h"
+#include "watchdog.h"
+#include "string.h"
+
+#include "arch/at91_pmc.h"
+#include "arch/at91_rstc.h"
+#include "arch/at91_pio.h"
+#include "arch/at91_ddrsdrc.h"
+#include "arch/at91_sfr.h"
+#include "xaprc001.h"
+#include "l2cc.h"
+#include "arch/tz_matrix.h"
+#include "matrix.h"
+
+/**
+ * UART/Console pinmux setup
+ *
+ * return None
+ */
+static void at91_dbgu_hw_init(void)
+{
+	const struct pio_desc dbgu_pins[] = {
+		{"RXD1", CONFIG_SYS_DBGU_RXD_PIN, 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{"TXD1", CONFIG_SYS_DBGU_TXD_PIN, 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{(char *)0, 0, 0, PIO_DEFAULT, PIO_PERIPH_A},
+	};
+
+	pio_configure(dbgu_pins);
+	pmc_sam9x5_enable_periph_clk(CONFIG_SYS_DBGU_ID);
+}
+
+/**
+ * UART/Console initialize
+ *
+ * return None
+ */
+static void initialize_dbgu(void)
+{
+	unsigned int baudrate = 115200;
+
+	at91_dbgu_hw_init();
+
+	if (pmc_check_mck_h32mxdiv())
+		usart_init(BAUDRATE(MASTER_CLOCK / 2, baudrate));
+	else
+		usart_init(BAUDRATE(MASTER_CLOCK, baudrate));
+}
+
+#if defined(CONFIG_MATRIX)
+/**
+ * Matrix slave configuration
+ *
+ * return 0 - Success
+ */
+static int matrix_configure_slave(void)
+{
+	unsigned int ddr_port;
+	unsigned int ssr_setting, sasplit_setting, srtop_setting;
+
+	/*
+	 * Matrix 0 (H64MX)
+	 */
+
+	/*
+	 * 0: Bridge from H64MX to AXIMX
+	 * (Internal ROM, Crypto Library, PKCC RAM): Always Secured
+	 */
+
+	/* 1: H64MX Peripheral Bridge */
+
+	/* 2 ~ 9 DDR2 Port1 ~ 7: Non-Secure */
+	srtop_setting = MATRIX_SRTOP(0, MATRIX_SRTOP_VALUE_128M);
+	sasplit_setting = (MATRIX_SASPLIT(0, MATRIX_SASPLIT_VALUE_128M)
+				| MATRIX_SASPLIT(1, MATRIX_SASPLIT_VALUE_128M)
+				| MATRIX_SASPLIT(2, MATRIX_SASPLIT_VALUE_128M)
+				| MATRIX_SASPLIT(3, MATRIX_SASPLIT_VALUE_128M));
+	ssr_setting = (MATRIX_LANSECH_NS(0)
+			| MATRIX_LANSECH_NS(1)
+			| MATRIX_LANSECH_NS(2)
+			| MATRIX_LANSECH_NS(3)
+			| MATRIX_RDNSECH_NS(0)
+			| MATRIX_RDNSECH_NS(1)
+			| MATRIX_RDNSECH_NS(2)
+			| MATRIX_RDNSECH_NS(3)
+			| MATRIX_WRNSECH_NS(0)
+			| MATRIX_WRNSECH_NS(1)
+			| MATRIX_WRNSECH_NS(2)
+			| MATRIX_WRNSECH_NS(3));
+	/* DDR port 0 not used from NWd */
+	for (ddr_port = 1; ddr_port < 8; ddr_port++) {
+		matrix_configure_slave_security(AT91C_BASE_MATRIX64,
+					(H64MX_SLAVE_DDR2_PORT_0 + ddr_port),
+					srtop_setting,
+					sasplit_setting,
+					ssr_setting);
+	}
+
+	/*
+	 * 10: Internal SRAM 128K
+	 * TOP0 is set to 128K
+	 * SPLIT0 is set to 64K
+	 * LANSECH0 is set to 0, the low area of region 0 is the Securable one
+	 * RDNSECH0 is set to 0, region 0 Securable area is secured for reads.
+	 * WRNSECH0 is set to 0, region 0 Securable area is secured for writes
+	 */
+	srtop_setting = MATRIX_SRTOP(0, MATRIX_SRTOP_VALUE_128K);
+	sasplit_setting = MATRIX_SASPLIT(0, MATRIX_SASPLIT_VALUE_64K);
+	ssr_setting = (MATRIX_LANSECH_S(0)
+			| MATRIX_RDNSECH_S(0)
+			| MATRIX_WRNSECH_S(0));
+	matrix_configure_slave_security(AT91C_BASE_MATRIX64,
+					H64MX_SLAVE_INTERNAL_SRAM,
+					srtop_setting,
+					sasplit_setting,
+					ssr_setting);
+
+	/* 11:  Internal SRAM 128K (Cache L2) */
+	/* 12:  QSPI0 */
+	/* 13:  QSPI1 */
+	/* 14:  AESB */
+
+	/*
+	 * Matrix 1 (H32MX)
+	 */
+
+	/* 0: Bridge from H32MX to H64MX: Not Secured */
+
+	/* 1: H32MX Peripheral Bridge 0: Not Secured */
+
+	/* 2: H32MX Peripheral Bridge 1: Not Secured */
+
+	/*
+	 * 3: External Bus Interface
+	 * EBI CS0 Memory(256M) ----> Slave Region 0, 1
+	 * EBI CS1 Memory(256M) ----> Slave Region 2, 3
+	 * EBI CS2 Memory(256M) ----> Slave Region 4, 5
+	 * EBI CS3 Memory(128M) ----> Slave Region 6
+	 * NFC Command Registers(128M) -->Slave Region 7
+	 *
+	 * NANDFlash(EBI CS3) --> Slave Region 6: Non-Secure
+	 */
+	srtop_setting =	MATRIX_SRTOP(6, MATRIX_SRTOP_VALUE_128M);
+	srtop_setting |= MATRIX_SRTOP(7, MATRIX_SRTOP_VALUE_128M);
+	sasplit_setting = MATRIX_SASPLIT(6, MATRIX_SASPLIT_VALUE_128M);
+	sasplit_setting |= MATRIX_SASPLIT(7, MATRIX_SASPLIT_VALUE_128M);
+	ssr_setting = (MATRIX_LANSECH_NS(6)
+			| MATRIX_RDNSECH_NS(6)
+			| MATRIX_WRNSECH_NS(6));
+	ssr_setting |= (MATRIX_LANSECH_NS(7)
+			| MATRIX_RDNSECH_NS(7)
+			| MATRIX_WRNSECH_NS(7));
+	matrix_configure_slave_security(AT91C_BASE_MATRIX32,
+					H32MX_EXTERNAL_EBI,
+					srtop_setting,
+					sasplit_setting,
+					ssr_setting);
+
+	/* 4: NFC SRAM (4K): Non-Secure */
+	srtop_setting = MATRIX_SRTOP(0, MATRIX_SRTOP_VALUE_8K);
+	sasplit_setting = MATRIX_SASPLIT(0, MATRIX_SASPLIT_VALUE_8K);
+	ssr_setting = (MATRIX_LANSECH_NS(0)
+			| MATRIX_RDNSECH_NS(0)
+			| MATRIX_WRNSECH_NS(0));
+	matrix_configure_slave_security(AT91C_BASE_MATRIX32,
+					H32MX_NFC_SRAM,
+					srtop_setting,
+					sasplit_setting,
+					ssr_setting);
+
+	/* 5:
+	 * USB Device High Speed Dual Port RAM (DPR): 1M
+	 * USB Host OHCI registers: 1M
+	 * USB Host EHCI registers: 1M
+	 */
+	srtop_setting = (MATRIX_SRTOP(0, MATRIX_SRTOP_VALUE_1M)
+			| MATRIX_SRTOP(1, MATRIX_SRTOP_VALUE_1M)
+			| MATRIX_SRTOP(2, MATRIX_SRTOP_VALUE_1M));
+	sasplit_setting = (MATRIX_SASPLIT(0, MATRIX_SASPLIT_VALUE_1M)
+			| MATRIX_SASPLIT(1, MATRIX_SASPLIT_VALUE_1M)
+			| MATRIX_SASPLIT(2, MATRIX_SASPLIT_VALUE_1M));
+	ssr_setting = (MATRIX_LANSECH_NS(0)
+			| MATRIX_LANSECH_NS(1)
+			| MATRIX_LANSECH_NS(2)
+			| MATRIX_RDNSECH_NS(0)
+			| MATRIX_RDNSECH_NS(1)
+			| MATRIX_RDNSECH_NS(2)
+			| MATRIX_WRNSECH_NS(0)
+			| MATRIX_WRNSECH_NS(1)
+			| MATRIX_WRNSECH_NS(2));
+	matrix_configure_slave_security(AT91C_BASE_MATRIX32,
+					H32MX_USB,
+					srtop_setting,
+					sasplit_setting,
+					ssr_setting);
+
+	return 0;
+}
+
+static unsigned int security_ps_peri_id[] = {
+	0,
+};
+
+/**
+ * Peripheral matrix configuration
+ *
+ * return 0 - Success, <0 - Failure
+ */
+static int matrix_config_periheral(void)
+{
+	unsigned int *peri_id = security_ps_peri_id;
+	unsigned int array_size = sizeof(security_ps_peri_id) / sizeof(unsigned int);
+	int ret;
+
+	ret = matrix_configure_peri_security(peri_id, array_size);
+	if (ret)
+		return -1;
+
+	return 0;
+}
+
+/**
+ * Matrix initialization
+ *
+ * return 0 - Success, <0 - Failure
+ */
+static int matrix_init(void)
+{
+	int ret;
+
+	matrix_write_protect_disable(AT91C_BASE_MATRIX64);
+	matrix_write_protect_disable(AT91C_BASE_MATRIX32);
+
+	ret = matrix_configure_slave();
+	if (ret)
+		return -1;
+
+	ret = matrix_config_periheral();
+	if (ret)
+		return -1;
+
+	return 0;
+}
+#endif	/* #if defined(CONFIG_MATRIX) */
+
+#if defined(CONFIG_DDR3)
+/**
+ * DDR3 initialization function
+ *
+ * @param   ddramc_config  - Pointer to DDR structure to be filled
+ *
+ * return None
+ */
+static void ddramc_reg_config(struct ddramc_register *ddramc_config)
+{
+	ddramc_config->mdr = (AT91C_DDRC2_DBW_16_BITS
+				| AT91C_DDRC2_MD_DDR3_SDRAM);
+
+	ddramc_config->cr = (AT91C_DDRC2_NC_DDR10_SDR9
+				| AT91C_DDRC2_NR_14
+				| AT91C_DDRC2_CAS_5
+				| AT91C_DDRC2_DISABLE_DLL
+				| AT91C_DDRC2_WEAK_STRENGTH_RZQ7
+				| AT91C_DDRC2_NB_BANKS_8
+				| AT91C_DDRC2_DECOD_INTERLEAVED
+				| AT91C_DDRC2_UNAL_SUPPORTED);
+
+	/*
+	 * According to MT41K128M16 datasheet
+	 * Maximum fresh period: 64ms, refresh count: 8k
+	 */
+#if CONFIG_BUS_SPEED_166MHZ
+	/* Refresh Timer is (64ms / 8k) * 166MHz = 1297(0x511) */
+	ddramc_config->rtr = 0x511;
+
+	/*
+	 * According to the sama5d2 datasheet and the following values:
+	 * T Sens = 0.75%/C, V Sens = 0.2%/mV, T driftrate = 1C/sec and V driftrate = 15 mV/s
+	 * Warning: note that the values T driftrate and V driftrate are dependent on
+	 * the application environment.
+	 * ZQCS period is 1.5 / ((0.75 x 1) + (0.2 x 15)) = 0.4s
+	 * If tref is 7.8us, we have: 400000 / 7.8 = 51282(0xC852)
+	 * */
+	ddramc_config->cal_mr4r = AT91C_DDRC2_COUNT_CAL(0xC852);
+
+	/* DDR3 ZQCS */
+	ddramc_config->tim_calr = AT91C_DDRC2_ZQCS(64);
+
+	/* Assume timings for 8ns min clock period */
+	ddramc_config->t0pr = (AT91C_DDRC2_TRAS_(6)
+			| AT91C_DDRC2_TRCD_(3)
+			| AT91C_DDRC2_TWR_(4)
+			| AT91C_DDRC2_TRC_(9)
+			| AT91C_DDRC2_TRP_(3)
+			| AT91C_DDRC2_TRRD_(4)
+			| AT91C_DDRC2_TWTR_(4)
+			| AT91C_DDRC2_TMRD_(4));
+
+	ddramc_config->t1pr = (AT91C_DDRC2_TRFC_(27)
+			| AT91C_DDRC2_TXSNR_(29)
+			| AT91C_DDRC2_TXSRD_(0)
+			| AT91C_DDRC2_TXP_(3));
+
+	ddramc_config->t2pr = (AT91C_DDRC2_TXARD_(0)
+			| AT91C_DDRC2_TXARDS_(0)
+			| AT91C_DDRC2_TRPA_(0)
+			| AT91C_DDRC2_TRTP_(4)
+			| AT91C_DDRC2_TFAW_(7));
+#else
+#error "No valid CLK setting defined"
+#endif
+}
+
+/**
+ * DDR3 initialization function additional
+ *
+ * return None
+ */
+static void ddramc_init(void)
+{
+	struct ddramc_register ddramc_reg;
+	unsigned int reg;
+
+	ddramc_reg_config(&ddramc_reg);
+
+	pmc_sam9x5_enable_periph_clk(AT91C_ID_MPDDRC);
+	pmc_enable_system_clock(AT91C_PMC_DDR);
+
+	/* MPDDRC I/O Calibration Register */
+	reg = readl(AT91C_BASE_MPDDRC + MPDDRC_IO_CALIBR);
+	reg &= ~AT91C_MPDDRC_RDIV;
+	reg |= AT91C_MPDDRC_RDIV_DDR2_RZQ_50;
+	reg &= ~AT91C_MPDDRC_TZQIO;
+
+	/* TZQIO field must be set to 600ns */
+#ifdef CONFIG_BUS_SPEED_166MHZ
+	reg |= AT91C_MPDDRC_TZQIO_(100);
+#else
+#error "No CLK setting defined"
+#endif
+	writel(reg, (AT91C_BASE_MPDDRC + MPDDRC_IO_CALIBR));
+
+	writel(AT91C_MPDDRC_RD_DATA_PATH_TWO_CYCLES,
+			(AT91C_BASE_MPDDRC + MPDDRC_RD_DATA_PATH));
+
+	ddr3_sdram_initialize(AT91C_BASE_MPDDRC, AT91C_BASE_DDRCS, &ddramc_reg);
+
+	ddramc_dump_regs(AT91C_BASE_MPDDRC);
+}
+
+#else
+#error "No right DDR-SDRAM device type provided"
+#endif
+
+/**
+ * The MSBs [bits 31:16] of the CAN Message RAM for CAN0 and CAN1
+ * are configured in 0x210000, instead of the default configuration
+ * 0x200000, to avoid conflict with SRAM map for PM.
+ */
+#define CAN_MESSAGE_RAM_MSB	0x21
+
+void at91_init_can_message_ram(void)
+{
+	writel(AT91C_CAN0_MEM_ADDR_(CAN_MESSAGE_RAM_MSB) |
+	       AT91C_CAN1_MEM_ADDR_(CAN_MESSAGE_RAM_MSB),
+	       (AT91C_BASE_SFR + SFR_CAN));
+}
+
+#ifdef CONFIG_HW_INIT
+/**
+ * Main entry for hardware initialization
+ *
+ * return None
+ */
+void hw_init(void)
+{
+	/* Disable watchdog */
+	at91_disable_wdt();
+
+	/* Configure PLLA */
+	pmc_cfg_plla(PLLA_SETTINGS);
+
+	/* Initialize PLLA charge pump */
+	/* No need: we keep what is set in ROM code */
+	//pmc_init_pll(0x3);
+
+	/* Switch MCK on PLLA output */
+	pmc_cfg_mck(BOARD_PRESCALER_PLLA);
+
+	/* Enable External Reset */
+	writel(AT91C_RSTC_KEY_UNLOCK | AT91C_RSTC_URSTEN,
+					AT91C_BASE_RSTC + RSTC_RMR);
+
+#if defined(CONFIG_MATRIX)
+	/* Initialize the matrix */
+	matrix_init();
+#endif
+	/* initialize the dbgu */
+	initialize_dbgu();
+
+	/* Init timer */
+	timer_init();
+
+#if defined(CONFIG_DDR3)
+	/* Initialize MPDDR Controller */
+	ddramc_init();
+#elif defined(CONFIG_LPDDR3)
+	lpddr3_init();
+#endif
+	/* Prepare L2 cache setup */
+	l2cache_prepare();
+
+	at91_init_can_message_ram();
+}
+#endif /* #ifdef CONFIG_HW_INIT */
+
+#ifdef CONFIG_SDCARD
+
+#define ATMEL_SDHC_GCKDIV_VALUE		1
+
+/**
+ * SD/eMMC pinmux initialization
+ *
+ * return None
+ */
+void at91_sdhc_hw_init(void)
+{
+#ifdef CONFIG_SDHC0
+	const struct pio_desc sdmmc_pins[] = {
+		{"SDMMC0_CK",   AT91C_PIN_PA(0), 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{"SDMMC0_CMD",  AT91C_PIN_PA(1), 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{"SDMMC0_DAT0", AT91C_PIN_PA(2), 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{"SDMMC0_DAT1", AT91C_PIN_PA(3), 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{"SDMMC0_DAT2", AT91C_PIN_PA(4), 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{"SDMMC0_DAT3", AT91C_PIN_PA(5), 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{"SDMMC0_DAT4", AT91C_PIN_PA(6), 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{"SDMMC0_DAT5", AT91C_PIN_PA(7), 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{"SDMMC0_DAT6", AT91C_PIN_PA(8), 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{"SDMMC0_DAT7", AT91C_PIN_PA(9), 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{"SDMMC0_RSTN", AT91C_PIN_PA(10), 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{"SDMMC0_CD",   AT91C_PIN_PA(13), 0, PIO_DEFAULT, PIO_PERIPH_A},
+		{(char *)0, 0, 0, PIO_DEFAULT, PIO_PERIPH_A},
+	};
+#endif
+
+	pio_configure(sdmmc_pins);
+
+	pmc_sam9x5_enable_periph_clk(CONFIG_SYS_ID_SDHC);
+	pmc_enable_periph_generated_clk(CONFIG_SYS_ID_SDHC,
+					GCK_CSS_MCK_CLK,
+					ATMEL_SDHC_GCKDIV_VALUE);
+}
+#endif
diff --git a/contrib/board/xaptum/xaprc001/xaprc001.h b/contrib/board/xaptum/xaprc001/xaprc001.h
new file mode 100644
index 0000000..10d947c
--- /dev/null
+++ b/contrib/board/xaptum/xaprc001/xaprc001.h
@@ -0,0 +1,68 @@
+/**
+ *  Copyright (c) 2018, Xaptum, Inc.
+ */
+#ifndef __XAPRC001_H__
+#define __XAPRC001_H__
+
+/*
+ * PMC Settings
+ */
+#define BOARD_MAINOSC		12000000
+
+/* PCK: 498MHz, MCK: 166MHz */
+#ifdef CONFIG_BUS_SPEED_166MHZ
+#define BOARD_PLLA_MULA		82
+#endif
+/* SAMA5D23 - SAMA5D28
+Frequency Monitor limitations
+PCK: 348MHz, MCK: 116MHz */
+#ifdef CONFIG_BUS_SPEED_116MHZ
+#define BOARD_PLLA_MULA		57
+#endif
+
+#define BOARD_PCK		((unsigned long)((BOARD_MAINOSC * (BOARD_PLLA_MULA + 1)) / 2))
+#define BOARD_MCK		((unsigned long)((BOARD_MAINOSC * (BOARD_PLLA_MULA + 1)) / 2 / 3))
+
+#define BOARD_CKGR_PLLA		(AT91C_CKGR_SRCA | AT91C_CKGR_OUTA_0)
+#define BOARD_PLLACOUNT		(0x3F << 8)
+#define BOARD_MULA		((AT91C_CKGR_MULA << 2) & (BOARD_PLLA_MULA << 18))
+#define BOARD_DIVA		(AT91C_CKGR_DIVA & 1)
+
+#define BOARD_PRESCALER_MAIN_CLOCK	(AT91C_PMC_PLLADIV2_2 \
+					| AT91C_PMC_MDIV_3 \
+					| AT91C_PMC_CSS_MAIN_CLK)
+
+#define BOARD_PRESCALER_PLLA		(AT91C_PMC_H32MXDIV_H32MXDIV2 \
+					| AT91C_PMC_PLLADIV2_2 \
+					| AT91C_PMC_MDIV_3 \
+					| AT91C_PMC_CSS_PLLA_CLK)
+
+#ifdef CONFIG_BUS_SPEED_166MHZ
+#define MASTER_CLOCK		166000000
+#endif
+#ifdef CONFIG_BUS_SPEED_116MHZ
+#define MASTER_CLOCK		116000000
+#endif
+
+#define PLLA_SETTINGS		(BOARD_CKGR_PLLA | \
+				BOARD_PLLACOUNT | \
+				BOARD_MULA | \
+				BOARD_DIVA)
+
+/*
+ * DBGU Settings
+ */
+#define USART_BASE			AT91C_BASE_UART1
+#define CONFIG_SYS_DBGU_RXD_PIN	AT91C_PIN_PD(2)
+#define CONFIG_SYS_DBGU_TXD_PIN	AT91C_PIN_PD(3)
+#define CONFIG_SYS_DBGU_ID		AT91C_ID_UART1
+
+/*
+ * SDHC Settings
+ */
+#ifdef CONFIG_SDHC0
+#define CONFIG_SYS_BASE_SDHC	AT91C_BASE_SDHC0
+#define CONFIG_SYS_ID_SDHC	AT91C_ID_SDMMC0
+#endif
+
+#endif
diff --git a/contrib/board/xaptum/xaprc001/xaprc001mmc_uboot_defconfig b/contrib/board/xaptum/xaprc001/xaprc001mmc_uboot_defconfig
new file mode 100644
index 0000000..d106ed8
--- /dev/null
+++ b/contrib/board/xaptum/xaprc001/xaprc001mmc_uboot_defconfig
@@ -0,0 +1,8 @@
+CONFIG_XAPRC001=y
+CONFIG_RAM_256MB=y
+CONFIG_DDR3=y
+CONFIG_SDCARD=y
+CONFIG_SDHC0=y
+CONFIG_SCLK=y
+CONFIG_SCLK_BYPASS=y
+# CONFIG_ENTER_NWD is not set
diff --git a/contrib/board/xaptum/xaprc001/xaprc001mmc_uboot_dev_defconfig b/contrib/board/xaptum/xaprc001/xaprc001mmc_uboot_dev_defconfig
new file mode 100644
index 0000000..7a62d42
--- /dev/null
+++ b/contrib/board/xaptum/xaprc001/xaprc001mmc_uboot_dev_defconfig
@@ -0,0 +1,9 @@
+CONFIG_XAPRC001=y
+CONFIG_RAM_256MB=y
+CONFIG_DDR3=y
+CONFIG_SDCARD=y
+CONFIG_SDHC0=y
+CONFIG_DEBUG=y
+CONFIG_SCLK=y
+CONFIG_SCLK_BYPASS=y
+# CONFIG_ENTER_NWD is not set
diff --git a/contrib/include/contrib_board.h b/contrib/include/contrib_board.h
index ad04326..9c576c6 100644
--- a/contrib/include/contrib_board.h
+++ b/contrib/include/contrib_board.h
@@ -57,4 +57,8 @@
 #include "sama5d3_linea.h"
 #endif
 
+#ifdef CONFIG_XAPRC001
+#include "xaprc001.h"
+#endif
+
 #endif
-- 
2.11.0

